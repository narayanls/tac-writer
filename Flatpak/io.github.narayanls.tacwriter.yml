id: io.github.narayanls.tacwriter
runtime: org.gnome.Platform
runtime-version: "47"
sdk: org.gnome.Sdk
command: tac-writer

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri              # Remove o aviso do libEGL/DRI3
  - --share=network           
  - --filesystem=host        
  - --env=ENCHANT_CONFIG_DIR=/app/share/enchant

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/man
  - /share/doc
  - /__pycache__

modules:
  - python3-requirements.yaml

  - name: tac-writer
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - mkdir -p /app/share
      
      # Copia tudo que está em usr/share (seu app, o .desktop e os ícones) 
      - cp -r share/* /app/share/

      # Instala .desktop
      - install -Dm644 share/applications/io.github.narayanls.tacwriter.desktop /app/share/applications/io.github.narayanls.tacwriter.desktop

      # Instala ícone do app
      - install -Dm644 share/icons/hicolor/scalable/apps/io.github.narayanls.tacwriter.svg /app/share/icons/hicolor/apps/io.github.narayanls.tacwriter.svg
      
      # Cria o executável
      - |
        echo '#!/bin/sh' > /app/bin/tac-writer
        echo 'export PYTHONPATH=/app/share/tac-writer:$PYTHONPATH' >> /app/bin/tac-writer
        echo 'exec python3 /app/share/tac-writer/main.py "$@"' >> /app/bin/tac-writer
        chmod +x /app/bin/tac-writer
    
    sources:
      - type: dir
        # Agora apontamos para a pasta "usr" raiz do repositório de build
        path: usr
